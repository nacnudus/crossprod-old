<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8"> 
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Duncan Garmonsway" />
        <meta name="copyright" content="Duncan Garmonsway" />

        <meta name="description" content="Porting a SimPy tutorial to the R package Simmer
" />
        <meta name="twitter:creator" content="@nacnudus">
        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="R, Simmer, SimPy, Miscellaneous, " />

<meta property="og:title" content="Simmer vs SimPy: The Bank, Part II "/>
<meta property="og:url" content="http://nacnudus.github.io/crossprod/simmer-vs-simpy-the-bank-part-ii" />
<meta property="og:description" content="Porting a SimPy tutorial to the R package Simmer" />
<meta property="og:site_name" content="Crossprod" />
<meta property="og:article:author" content="Duncan Garmonsway" />
<meta property="og:article:published_time" content="2016-06-06T00:00:00+12:00" />
<meta name="twitter:title" content="Simmer vs SimPy: The Bank, Part II ">
<meta name="twitter:description" content="Porting a SimPy tutorial to the R package Simmer">
<meta property="og:image" content="http://nacnudus.github.io/crossprod/theme/images/apple-touch-icon-152x152.png" />
<meta name="twitter:image" content="http://nacnudus.github.io/crossprod/theme/images/apple-touch-icon-152x152.png" >

        <title>Simmer vs SimPy: The Bank, Part II  · Crossprod
</title>
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
        <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.1/css/font-awesome.css" rel="stylesheet">
<link rel="stylesheet" href="http://nacnudus.github.io/crossprod/theme/css/style.min.css?2f9bb2f8">
        <link rel="shortcut icon" href="http://nacnudus.github.io/crossprod/theme/images/favicon.ico" type="image/x-icon" type="image/png" />
        <link rel="icon" href="http://nacnudus.github.io/crossprod/theme/images/apple-touch-icon-152x152.png" type="image/png" />
        <link rel="apple-touch-icon" href="http://nacnudus.github.io/crossprod/theme/images/apple-touch-icon.png"  type="image/png" />
        <link rel="apple-touch-icon" sizes="57x57" href="http://nacnudus.github.io/crossprod/theme/images/apple-touch-icon-57x57.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="72x72" href="http://nacnudus.github.io/crossprod/theme/images/apple-touch-icon-72x72.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="76x76" href="http://nacnudus.github.io/crossprod/theme/images/apple-touch-icon-76x76.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="114x114" href="http://nacnudus.github.io/crossprod/theme/images/apple-touch-icon-114x114.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="120x120" href="http://nacnudus.github.io/crossprod/theme/images/apple-touch-icon-120x120.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="144x144" href="http://nacnudus.github.io/crossprod/theme/images/apple-touch-icon-144x144.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="152x152" href="http://nacnudus.github.io/crossprod/theme/images/apple-touch-icon-152x152.png" type="image/png" />
        <link href="http://nacnudus.github.io/crossprod/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Crossprod - Full Atom Feed" />
        <link href="http://nacnudus.github.io/crossprod/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Crossprod - Full RSS Feed" />
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
     m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-45097885-3', 'auto');
    ga('send', 'pageview');
</script>
    </head>
    <body>
        <div id="content-sans-footer">
        <div class="navbar navbar-static-top">
            <div class="navbar-inner">
                <div class="container-fluid">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="http://nacnudus.github.io/crossprod/"><span class=site-name>Crossprod</span></a>
                    <div class="nav-collapse collapse">
                        <ul class="nav pull-right top-menu">
                            <li ><a href="http://nacnudus.github.io/crossprod">Home</a></li>
                            <li ><a href="http://nacnudus.github.io/crossprod/categories.html">Categories</a></li>
                            <li ><a href="http://nacnudus.github.io/crossprod/tags.html">Tags</a></li>
                            <li ><a href="http://nacnudus.github.io/crossprod/archives.html">Archives</a></li>
                            <li><form class="navbar-search" action="http://nacnudus.github.io/crossprod/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid">
            <div class="row-fluid">
                <div class="span1"></div>
                <div class="span10">
<article>
<div class="row-fluid">
    <header class="page-header span10 offset2">
    <h1><a href="http://nacnudus.github.io/crossprod/simmer-vs-simpy-the-bank-part-ii"> Simmer vs SimPy: The Bank, Part <span class="caps">II</span>  </a></h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">

            
            <h2 id="simmer-vs-simpy-rematch">Simmer vs SimPy&nbsp;(rematch)</h2>
<p>In my <a href="http://nacnudus.github.io/crossprod/simmer-vs-simpy-the-bank-part-i">previous post</a>, I ported <a href="https://pythonhosted.org/SimPy/Tutorials/TheBank.html">Part I</a> of <code>SimPy</code><span class="quo">&#8216;</span>s flagship
tutorial, <em>The Bank</em>, to <code>simmer</code>.  This post does the same for <a href="https://pythonhosted.org/SimPy/Tutorials/TheBank2.html">Part <span class="caps">II</span></a>, which introduces tricky concepts for tricky&nbsp;customers.</p>
<p>This post does two&nbsp;things:</p>
<ul>
<li>Discusses some difficulties implementing The Bank: Part <span class="caps">II</span>.</li>
<li>Suggests some reasons why simulation is hard (blame&nbsp;humans).</li>
</ul>
<h2 id="the-bank">The&nbsp;Bank</h2>
<p><span class="quo">&#8216;</span>The Bank&#8217; is a tutorial that develops <span class="caps">DES</span> concepts and techniques by simulating
the paths of customers at a bank.  The arrivals (customers) queue for a server
(counter), are served, and&nbsp;exit.</p>
<h2 id="complete-code">Complete&nbsp;code</h2>
<p>The actual ported code is available <a href="https://github.com/nacnudus/simmer-bank">on
GitHub</a>, and I only give simple
examples in this&nbsp;post.</p>
<h2 id="priority-and-pre-emption">Priority and&nbsp;pre-emption</h2>
<p>High-priority arrivals (customers) go straight to the front of the queue.  When
pre-emption is allowed, they can even barge they way onto a busy server,
interrupting an arrival (customer) that is already being&nbsp;served.</p>
<p>Priority and pre-emption has only recently been added to <code>simmer</code>, and it still
feels a bit clumsy.  The complications arise because events have to be
rescheduled, and decisions have to be remade.  For&nbsp;example:</p>
<ul>
<li>When a server is serving several arrivals at once, which one should be
  interrupted by a higher-priority arrival?  <code>Simmer</code> already implements
  first-in-first-out (<span class="caps">FIFO</span>) and last-in-first-out (<span class="caps">LIFO</span>)&nbsp;policies.</li>
<li>When an arrival is interrupted while being served, and then resumes service,
  should they start again (repeating the first period of their service time) or
  carry on from where they left off (completing their remaining service time).
  <code>Simmer</code> already implements these two options, but it&#8217;s reasonable to suppose
  that resumption of service might come with a time penalty, and it doesn&#8217;t
  currently seem to be possible to express such a&nbsp;penalty.</li>
<li>While an interrupted arrival is waiting to return to the server, where do they
  wait?  This matters in a finite queue.  Currently, <code>simmer</code> allows the arrival
  to wait in the finite queue, even if the queue is already full and rejecting
  new arrivals.  To change this behaviour, one would have to define a policy for
  ejecting arrivals from the queue to maintain the constraint on its&nbsp;size.</li>
</ul>
<h2 id="balking-and-reneging">Balking and&nbsp;reneging</h2>
<p>Balking is the behaviour of an arrival that, for some reason, never enters a
queue.  The example in The Bank Tutorial is the case when a finite queue is
full, so the arrival is rejected.  An alternative might be that the arrival
decides whether or not to enter the queue according to the number of arrivals
already in it.  That scenario can already be implemented in <code>simmer</code> by branching
based on an enquiry into the state of the&nbsp;queue.</p>
<p>Reneging is the behaviour of an arrival already in a queue, who decides to leave
it.  This isn&#8217;t yet possible in <code>simmer</code>, but the authors have indulged me in
several discussions about it, on
<a href="https://github.com/r-simmer/simmer/issues">GitHub</a> and in the <a href="https://groups.google.com/forum/#!forum/simmer-devel">discussion
forum</a>.  The difficulty,
as I currently see it, is that the <code>seize</code> function, by handling the whole
interval between entering the queue and reaching the server, makes the queueing
period relatively inaccessible.  If one wanted an arrival to renege from one
queue and branch instead into another queue, there is no way to express that
inside the <code>seize</code> function.  If one wanted other customers in the queue to
reassess their patience, based on customers ahead of them reneging, then there
is no way to express that idea&nbsp;either.</p>
<p>To be fair to the <code>simmer</code> authors, these ideas weren&#8217;t present in early
versions of <code>SimPy</code> either, and were still clumsy when The Bank: Part <span class="caps">II</span> was
written.  It also can&#8217;t be easy to separate the concept of queueing from the
<code>seize</code> function, since this is probably the most computationally-expensive
aspect of modelling, which has, very sensibly, been implemented in&nbsp;C++.</p>
<h2 id="interruption">Interruption</h2>
<p><code>SimPy</code> provides functions for interrupting an arrival that is being served.
The examples in The Bank Tutorial don&#8217;t convince me that special functions are
necessary. Why not simply increase their service time?  That&#8217;s certainly how I
implemented interruptions in <code>simmer</code>.</p>
<h2 id="wait-until">Wait&nbsp;until</h2>
<p>Another relatively new feature of <code>simmer</code> is the ability to schedule the
capacity of resources at certain times.  I used schedules to implement the bank
opening in the morning, and to &#8216;open the door&#8217; once every 30 minutes to let in
any customers that are queueing&nbsp;outside.</p>
<p>The scheduling feature can be periodic, which is wonderful, but it isn&#8217;t
currently possible to schedule a single change in capacity that then endures
indefinitely.  See
<a href="https://github.com/nacnudus/simmer-bank/blob/master/17-waituntil.R">GitHub</a> for
examples.  It also doesn&#8217;t seem to be possible to schedule infinite&nbsp;capacity.</p>
<p><strong>[<span class="caps">EDIT</span>]</strong>  I was wrong.  It is possible to do both those&nbsp;things.</p>
<h2 id="monitoring-and-plotting">Monitoring and&nbsp;plotting</h2>
<p>Here is where <code>simmer</code> continues to excel, providing far simpler and
more-intuitive monitoring of arrivals, resources and attributes, in handy data
frames for straightforward plotting with any graphics&nbsp;library.</p>
<h2 id="simulation-is-hard">Simulation is&nbsp;hard</h2>
<p>Because human behaviour is hard.  Real-life systems involving humans are
massively parallel.  Every actor processes his/her own activities onto the
universal time-line.  As long as computers have very finite numbers of
processors, simulation libraries will have to find ways to express this
parallelism in a way that computers can serialise.  When actors in a system
influence each-other&#8217;s behaviour, the computational difficulties of serialising
their behaviour begin to meet the boundaries of efficient&nbsp;computation.</p>
<p>The authors of <code>simmer</code> have a very generous attitude towards suggestions and
discussion, like so many R developers.  No doubt that this post will soon become
obsolete by their&nbsp;efforts.</p>
            <section>
    <p id="post-share-links">
    Like this post? Subscribe with <a href="https://nacnudus.github.io/crossprod/feeds/all.rss.xml" title="RSS">RSS</a>. Share on:
    <a href="http://twitter.com/home?status=Simmer%20vs%20SimPy%3A%20The%20Bank%2C%20Part%20II%20http%3A//nacnudus.github.io/crossprod/simmer-vs-simpy-the-bank-part-ii" target="_blank" title="Share on Twitter">Twitter</a>
    ❄
    <a href="http://www.facebook.com/sharer/sharer.php?u=http%3A//nacnudus.github.io/crossprod/simmer-vs-simpy-the-bank-part-ii" target="_blank" title="Share on Facebook">Facebook</a>
    ❄
    <a href="https://plus.google.com/share?url=http%3A//nacnudus.github.io/crossprod/simmer-vs-simpy-the-bank-part-ii" target="_blank" title="Share on Google Plus">Google+</a>
    ❄
    <a href="mailto:?subject=Simmer%20vs%20SimPy%3A%20The%20Bank%2C%20Part%20II&amp;body=http%3A//nacnudus.github.io/crossprod/simmer-vs-simpy-the-bank-part-ii" target="_blank" title="Share via Email">Email</a>
    </p>
</section>

            <section>
<p id="comment-message">Please comment below </p>
<div class="accordion" id="accordion2">
    <div class="accordion-group">
        <div class="accordion-heading">
            <a class="accordion-toggle disqus-comment-count" data-toggle="collapse" data-parent="#accordion2"
                    data-disqus-identifier="simmer-bank-2"
                href="http://nacnudus.github.io/crossprod/simmer-vs-simpy-the-bank-part-ii#disqus_thread">
                Comments
            </a>
        </div>
        <div id="disqus_thread" class="accordion-body collapse">
            <div class="accordion-inner">
                <div class="comments">
                    <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'crossprod';
        var disqus_identifier = 'simmer-bank-2';
    var disqus_url = 'http://nacnudus.github.io/crossprod/simmer-vs-simpy-the-bank-part-ii';

    (function() {
         var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
         dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
         (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
     })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

                </div>
            </div>
        </div>
    </div>
</div>
</section>

            <hr/>
            <aside>
            <nav>
            <ul class="articles-timeline">
                <li class="previous-article">« <a href="http://nacnudus.github.io/crossprod/simmer-vs-simpy-the-bank-part-i" title="Previous: Simmer vs SimPy: The Bank, Part I">Simmer vs SimPy: The Bank, Part I</a></li>
                <li class="next-article"><a href="http://nacnudus.github.io/crossprod/brexit-poll-of-polls" title="Next: Brexit poll of polls">Brexit poll of polls</a> »</li>
            </ul>
            </nav>
            </aside>
        </div>
        <section>
        <div class="span2" style="float:right;font-size:0.9em;">
            <h4>Published</h4>
            <time pubdate="pubdate" datetime="2016-06-06T00:00:00+12:00">Jun 6, 2016</time>
            <h4>Category</h4>
            <a class="category-link" href="http://nacnudus.github.io/crossprod/categories.html#miscellaneous-ref">Miscellaneous</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="http://nacnudus.github.io/crossprod/tags.html#r-ref">R
                    <span>10</span>
</a></li>
                <li><a href="http://nacnudus.github.io/crossprod/tags.html#simmer-ref">Simmer
                    <span>2</span>
</a></li>
                <li><a href="http://nacnudus.github.io/crossprod/tags.html#simpy-ref">SimPy
                    <span>2</span>
</a></li>
            </ul>
<h4>Social</h4>
    <a href="https://github.com/nacnudus" title="My Github Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-github sidebar-social-links"></i></a>
    <a href="https://twitter.com/nacnudus" title="My Twitter Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-twitter sidebar-social-links"></i></a>
    <a href="https://nz.linkedin.com/in/duncangarmonsway" title="My LinkedIn Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-linkedin sidebar-social-links"></i></a>
    <a href="https://nacnudus.github.io/crossprod/feeds/all.rss.xml" title="Subscribe in a reader" class="sidebar-social-links" target="_blank">
    <i class="fa fa-rss sidebar-social-links"></i></a>
        </div>
        </section>
</div>
</article>
                </div>
                <div class="span1"></div>
            </div>
        </div>
        <div id="push"></div>
    </div>
<footer>
<div id="footer">
    <ul class="footer-content">
        <li class="elegant-subtitle"><span class="site-name">Crossprod</span> - R, data, and frustration</li>
        <li class="elegant-power">Powered by <a href="http://getpelican.com/" title="Pelican Home Page">Pelican</a>. Theme: <a href="http://oncrashreboot.com/pelican-elegant" title="Theme Elegant Home Page">Elegant</a> by <a href="http://oncrashreboot.com" title="Talha Mansoor Home Page">Talha Mansoor</a></li>
    </ul>
</div>
</footer>            <script src="http://code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

            <script type="text/javascript">
var disqus_shortname = 'crossprod';
(function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>
<script  language="javascript" type="text/javascript">
function uncollapse() {
    if (window.location.hash.match(/^#comment-\d+$/)) {
        $('#disqus_thread').collapse('show');
    }
}
</script>
<script type="text/javascript" language="JavaScript">
uncollapse();
window.onhashchange=function(){
    if (window.location.hash.match(/^#comment-\d+$/))
        window.location.reload(true);
}
</script>
<script>
$('#disqus_thread').on('shown', function () {
    var link = document.getElementsByClassName('accordion-toggle');
    var old_innerHTML = link[0].innerHTML;
    $(link[0]).fadeOut(500, function() {
        $(this).text('Click here to hide comments').fadeIn(500);
    });
    $('#disqus_thread').on('hidden', function () {
        $(link[0]).fadeOut(500, function() {
            $(this).text(old_innerHTML).fadeIn(500);
        });
    })
})
</script>


    </body>
    <!-- Theme: Elegant built for Pelican
    License : http://oncrashreboot.com/pelican-elegant -->
</html>